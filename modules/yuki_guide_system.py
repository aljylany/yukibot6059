"""
نظام دليل يوكي الشامل - مرشد الألعاب والأوامر
Yuki's Comprehensive Guide System - Games and Commands Guide
"""

import logging
import random
from typing import Dict, List

class YukiGuideSystem:
    """نظام دليل يوكي الشامل لجميع الألعاب والأوامر"""
    
    def __init__(self):
        self.games_data = self._load_games_data()
        self.categories = self._load_categories()
    
    def _load_games_data(self) -> Dict:
        """تحميل بيانات جميع الألعاب والأوامر"""
        return {
            # الألعاب الاقتصادية
            "البنوك": {
                "emoji": "🏦",
                "description": "نظام مصرفي متكامل لإدارة أموالك",
                "commands": [
                    ("انشاء حساب بنكي", "إنشاء حساب مصرفي جديد واختيار البنك المناسب"),
                    ("الأهلي / الراجحي / سامبا / الرياض", "اختيار نوع البنك عند التسجيل"),
                    ("ايداع [المبلغ]", "إيداع أموال في حسابك البنكي"),
                    ("سحب [المبلغ]", "سحب أموال من حسابك البنكي"),
                    ("تحويل [المبلغ] [المعرف]", "تحويل أموال لمستخدم آخر"),
                    ("راتب", "الحصول على الراتب اليومي (كل 5 دقائق)"),
                    ("فلوسي", "عرض رصيدك الحالي"),
                    ("رصيدي", "عرض رصيد البنك والنقد معاً")
                ],
                "tips": [
                    "💡 كل بنك له مميزات مختلفة في الراتب والمكافآت",
                    "💡 احتفظ بأموالك في البنك لحمايتها من السرقة",
                    "💡 الراتب اليومي يختلف حسب نوع البنك المختار"
                ]
            },
            
            "العقارات": {
                "emoji": "🏠",
                "description": "استثمر في العقارات واحصل على دخل ثابت",
                "commands": [
                    ("عقارات", "عرض محفظة العقارات الخاصة بك"),
                    ("شراء عقار", "عرض العقارات المتاحة للشراء"),
                    ("بيع عقار", "بيع أحد العقارات المملوكة لك"),
                    ("شقة / بيت / فيلا / مبنى / مول", "شراء أنواع مختلفة من العقارات"),
                    ("ناطحة / مكتب / مستودع / مصنع / منتجع", "عقارات متقدمة بأرباح أعلى")
                ],
                "tips": [
                    "💡 العقارات تعطيك دخل ثابت كل ساعة",
                    "💡 العقارات الأغلى تحقق أرباح أكبر",
                    "💡 يمكنك امتلاك عدة عقارات من نفس النوع"
                ]
            },
            
            "الأسهم": {
                "emoji": "📈",
                "description": "تداول في أسهم الشركات العربية الكبرى",
                "commands": [
                    ("اسهم", "عرض أسعار الأسهم الحالية"),
                    ("شراء سهم [الاسم] [العدد]", "شراء أسهم من شركة معينة"),
                    ("بيع سهم [الاسم] [العدد]", "بيع أسهم مملوكة لك"),
                    ("محفظتي", "عرض أسهمك والأرباح/الخسائر"),
                    ("ارامكو / الراجحي / سابك", "أسهم شركات رئيسية"),
                    ("اتصالات / الكهرباء / معادن", "أسهم شركات إضافية")
                ],
                "tips": [
                    "💡 أسعار الأسهم تتغير باستمرار",
                    "💡 اشتري عندما تنخفض الأسعار وبع عندما ترتفع",
                    "💡 تنويع المحفظة يقلل المخاطر"
                ]
            },
            
            "الاستثمار": {
                "emoji": "💎",
                "description": "استثمار بسيط وسريع أو متقدم طويل المدى",
                "commands": [
                    ("استثمار [المبلغ]", "استثمار سريع بعوائد فورية (0-30%)"),
                    ("استثمار فلوسي", "استثمار كامل رصيدك النقدي"),
                    ("استثمار متقدم", "استثمار طويل المدى في الشركات"),
                    ("محفظة استثمار", "عرض استثماراتك المتقدمة")
                ],
                "tips": [
                    "💡 الاستثمار البسيط سريع لكن عشوائي",
                    "💡 الاستثمار المتقدم أكثر أماناً وربحية",
                    "💡 يمكنك الاستثمار كل 5 دقائق"
                ]
            },
            
            "المزارع": {
                "emoji": "🌾",
                "description": "ازرع المحاصيل واحصدها لتحقيق الأرباح",
                "commands": [
                    ("مزرعة", "عرض حالة مزرعتك"),
                    ("زراعة [النوع] [العدد]", "زراعة محاصيل جديدة"),
                    ("حصاد محاصيلي", "حصاد جميع المحاصيل الجاهزة"),
                    ("حصاد [النوع] [العدد]", "حصاد نوع معين بكمية محددة"),
                    ("طماطم / خيار / جزر / بطاطا", "أنواع مختلفة من المحاصيل")
                ],
                "tips": [
                    "💡 كل محصول له وقت نمو مختلف",
                    "💡 المحاصيل الأغلى تحتاج وقت أطول",
                    "💡 احصد في الوقت المناسب للحصول على أفضل الأرباح"
                ]
            },
            
            "القلاع": {
                "emoji": "🏰",
                "description": "ابني قلعتك وطورها وادافع عنها",
                "commands": [
                    ("قلعة", "عرض معلومات قلعتك"),
                    ("بناء قلعة", "بناء قلعة جديدة"),
                    ("ترقية قلعة", "ترقية مستوى القلعة"),
                    ("شراء [المورد] [العدد]", "شراء موارد للقلعة"),
                    ("اخفاء قلعتي", "إخفاء القلعة عن الآخرين"),
                    ("اظهار قلعتي", "إظهار القلعة للآخرين"),
                    ("حذف قلعتي", "حذف القلعة نهائياً"),
                    ("كنز", "البحث عن الكنوز (يومياً)")
                ],
                "tips": [
                    "💡 الموارد مطلوبة لترقية القلعة",
                    "💡 القلاع المخفية أكثر أماناً",
                    "💡 البحث عن الكنوز يعطي موارد مجانية"
                ]
            },
            
            "السرقة": {
                "emoji": "🔓",
                "description": "نظام سرقة تفاعلي مع حماية متقدمة",
                "commands": [
                    ("امان", "عرض مستوى الأمان وإحصائيات السرقة"),
                    ("ترقية الامان", "ترقية مستوى الحماية"),
                    ("سرقة / سرف", "رد على رسالة شخص واكتب للسرقة"),
                    ("احصائيات سرقة", "عرض إحصائيات السرقة التفصيلية"),
                    ("افضل لصوص", "عرض قائمة أفضل اللصوص")
                ],
                "tips": [
                    "💡 ارفع مستوى الأمان لحماية أموالك",
                    "💡 الأموال في البنك محمية تماماً",
                    "💡 السرقة تعتمد على الحظ ومستوى الأمان"
                ]
            },
            
            # الألعاب الترفيهية
            "الألعاب": {
                "emoji": "🎮",
                "description": "ألعاب ترفيهية متنوعة لكسب النقاط والمتعة",
                "commands": [
                    ("العاب", "عرض قائمة جميع الألعاب المتاحة"),
                    ("xo", "لعبة إكس-أو التفاعلية"),
                    ("ملكة", "لعبة الملكة والأوراق"),
                    ("معركة", "معركة الساحة ضد لاعبين آخرين"),
                    ("عجلة الحظ", "دوران عجلة الحظ للفوز بجوائز"),
                    ("تخمين رقم", "تخمين رقم من 1 إلى 100"),
                    ("كلمات", "لعبة الكلمات والمعاني"),
                    ("رموز", "لعبة مطابقة الرموز"),
                    ("ترتيب حروف", "ترتيب الحروف لتكوين كلمات")
                ],
                "tips": [
                    "💡 الألعاب تعطي نقاط خبرة وأحياناً جوائز نقدية",
                    "💡 العب مع الأصدقاء لمتعة أكبر",
                    "💡 بعض الألعاب تحتاج إلى مشاركة اللاعبين"
                ]
            },
            
            # أنظمة إضافية
            "المعلومات": {
                "emoji": "ℹ️",
                "description": "أوامر للحصول على معلومات شخصية ومعلومات الآخرين",
                "commands": [
                    ("رتبتي", "عرض رتبتك الحالية في المجموعة"),
                    ("مستواي", "عرض مستواك ونقاط الخبرة"),
                    ("فلوسه", "رد على رسالة شخص لمعرفة رصيده"),
                    ("رتبته", "رد على رسالة شخص لمعرفة رتبته"),
                    ("مستواه", "رد على رسالة شخص لمعرفة مستواه"),
                    ("ترتيب", "عرض ترتيب أغنى اللاعبين"),
                    ("المستويات", "دليل شامل لنظام المستويات والعوالم")
                ],
                "tips": [
                    "💡 اكسب نقاط خبرة بممارسة الألعاب والأنشطة",
                    "💡 المستوى الأعلى يفتح ميزات إضافية",
                    "💡 الرتب تتغير حسب نشاطك وأموالك"
                ]
            },
            
            "أوامر خاصة": {
                "emoji": "⭐",
                "description": "أوامر وميزات خاصة متنوعة",
                "commands": [
                    ("زواج [معرف الشريك]", "نظام الزواج مع مهر ووسطة القاضي"),
                    ("هدية [المعرف] [المبلغ]", "إرسال هدية نقدية لشخص"),
                    ("احتفال", "إنشاء احتفال جماعي في المجموعة"),
                    ("حظي اليوم", "معرفة حظك لهذا اليوم"),
                    ("نصيحة", "الحصول على نصيحة عشوائية مفيدة"),
                    ("دعاء", "دعاء إسلامي أو آية قرآنية"),
                    ("مسح المحادثات", "مسح ذاكرة محادثاتك مع يوكي"),
                    ("اوامر يوكي", "عرض هذا الدليل الشامل! 😊")
                ],
                "tips": [
                    "💡 نظام الزواج يتطلب موافقة الطرفين ووسيط",
                    "💡 الهدايا تقوي الروابط الاجتماعية",
                    "💡 أوامر الترفيه تضيف جو من المرح للمجموعة"
                ]
            }
        }
    
    def _load_categories(self) -> List[str]:
        """تحميل فئات الألعاب الرئيسية"""
        return [
            "البنوك", "العقارات", "الأسهم", "الاستثمار", 
            "المزارع", "القلاع", "السرقة", "الألعاب", 
            "المعلومات", "أوامر خاصة"
        ]
    
    def get_full_guide(self) -> str:
        """الحصول على الدليل المختصر لجميع الأوامر"""
        guide_text = "🎮 **دليل يوكي الشامل** 🎮\n\n"
        guide_text += "مرحباً! أنا مرشدك الذكي للألعاب! 🤖\n\n"
        
        # عرض مختصر جداً للفئات
        guide_text += "🏦 **البنوك:** `انشاء حساب` • `راتب` • `ايداع/سحب`\n"
        guide_text += "🏠 **العقارات:** `عقارات` • `شراء شقة/فيلا`\n"
        guide_text += "📈 **الأسهم:** `اسهم` • `شراء ارامكو` • `محفظتي`\n"
        guide_text += "💎 **الاستثمار:** `استثمار 1000` • `استثمار متقدم`\n"
        guide_text += "🌾 **المزارع:** `مزرعة` • `زراعة` • `حصاد`\n"
        guide_text += "🏰 **القلاع:** `قلعة` • `بناء قلعة` • `كنز`\n"
        guide_text += "🔓 **السرقة:** `امان` • سرقة بالرد على رسالة\n"
        guide_text += "🎮 **الألعاب:** `العاب` • `xo` • `ملكة` • `معركة`\n"
        guide_text += "ℹ️ **المعلومات:** `رتبتي` • `فلوسي` • `مستواي`\n"
        guide_text += "⭐ **أوامر خاصة:** `زواج` • `هدية` • `حظي`\n\n"
        
        guide_text += "🌟 **للمبتدئين:**\n"
        guide_text += "1️⃣ `انشاء حساب بنكي`\n2️⃣ `راتب`\n3️⃣ `العاب`\n\n"
        
        guide_text += "💡 **للمساعدة:** 'يوكي [سؤالك]' 🧠\n"
        guide_text += "مثال: 'يوكي كيف أستثمر؟'"
        
        return guide_text
    
    def get_category_guide(self, category: str) -> str:
        """الحصول على دليل فئة معينة"""
        if category not in self.games_data:
            return "❌ لم أجد هذه الفئة. اكتب 'أوامر يوكي' لرؤية جميع الفئات المتاحة."
        
        data = self.games_data[category]
        guide_text = f"{data['emoji']} **دليل {category}** {data['emoji']}\n\n"
        guide_text += f"📝 {data['description']}\n\n"
        
        # عرض أهم الأوامر فقط (أول 6 أوامر)
        guide_text += "📋 **الأوامر الرئيسية:**\n"
        for command, description in data['commands'][:6]:
            guide_text += f"• `{command}` - {description}\n"
        
        if len(data['commands']) > 6:
            guide_text += f"... و {len(data['commands']) - 6} أوامر أخرى\n"
        
        # عرض أول نصيحتين فقط
        guide_text += "\n💡 **نصائح مفيدة:**\n"
        for tip in data['tips'][:2]:
            guide_text += f"{tip}\n"
        
        guide_text += "\n💬 للدليل الكامل: 'أوامر يوكي'\n"
        guide_text += "🤖 للمساعدة: 'يوكي [سؤالك]'"
        
        return guide_text
    
    def search_command(self, query: str) -> str:
        """البحث عن أمر معين في النظام"""
        query_lower = query.lower()
        results = []
        
        for category, data in self.games_data.items():
            for command, description in data['commands']:
                if query_lower in command.lower() or query_lower in description.lower():
                    results.append({
                        'category': category,
                        'emoji': data['emoji'],
                        'command': command,
                        'description': description
                    })
        
        if not results:
            return f"🔍 لم أجد نتائج لـ '{query}'. جرب البحث بكلمة أخرى أو اكتب 'أوامر يوكي' لرؤية جميع الأوامر."
        
        result_text = f"🔍 **نتائج البحث عن '{query}':**\n\n"
        
        for result in results[:10]:  # عرض أول 10 نتائج فقط
            result_text += f"{result['emoji']} **{result['category']}**\n"
            result_text += f"• `{result['command']}` - {result['description']}\n\n"
        
        if len(results) > 10:
            result_text += f"... و {len(results) - 10} نتيجة أخرى\n\n"
        
        result_text += "💡 لرؤية جميع الأوامر، اكتب: 'أوامر يوكي'"
        
        return result_text
    
    def get_random_tip(self) -> str:
        """الحصول على نصيحة عشوائية"""
        all_tips = []
        for data in self.games_data.values():
            all_tips.extend(data['tips'])
        
        if all_tips:
            tip = random.choice(all_tips)
            return f"💡 **نصيحة يوكي:** {tip}"
        
        return "💡 **نصيحة يوكي:** استخدم 'أوامر يوكي' لرؤية جميع الإمكانيات!"
    
    def is_guide_request(self, message: str) -> bool:
        """فحص إذا كانت الرسالة تطلب الدليل"""
        guide_triggers = [
            'أوامر يوكي', 'اوامر يوكي', 'أوامر البوت', 'اوامر البوت',
            'دليل يوكي', 'مساعدة يوكي', 'help yuki', 'yuki commands',
            'كيف العب', 'كيف ألعب', 'علمني', 'ساعدني', 'شرح الألعاب',
            'قائمة الأوامر', 'قائمة الالعاب', 'جميع الأوامر'
        ]
        
        message_lower = message.lower()
        return any(trigger in message_lower for trigger in guide_triggers)
    
    def is_category_request(self, message: str) -> tuple:
        """فحص إذا كانت الرسالة تطلب فئة معينة"""
        message_lower = message.lower()
        
        category_triggers = {
            'البنوك': ['بنك', 'مصرف', 'حساب', 'راتب', 'ايداع', 'سحب'],
            'العقارات': ['عقار', 'بيت', 'شقة', 'فيلا', 'مبنى'],
            'الأسهم': ['اسهم', 'سهم', 'تداول', 'محفظة'],
            'الاستثمار': ['استثمار', 'استثمر'],
            'المزارع': ['مزرعة', 'زراعة', 'حصاد', 'محصول'],
            'القلاع': ['قلعة', 'قلع', 'كنز'],
            'السرقة': ['سرقة', 'سرف', 'أمان', 'امان', 'حماية'],
            'الألعاب': ['لعبة', 'العاب', 'ألعاب', 'xo', 'ملكة'],
            'المعلومات': ['معلومات', 'رتبة', 'مستوى', 'ترتيب'],
            'أوامر خاصة': ['زواج', 'هدية', 'احتفال', 'حظ', 'نصيحة']
        }
        
        for category, triggers in category_triggers.items():
            if any(trigger in message_lower for trigger in triggers):
                return True, category
        
        return False, None

# إنشاء نسخة واحدة من نظام الدليل
yuki_guide = YukiGuideSystem()