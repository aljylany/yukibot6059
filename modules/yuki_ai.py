"""
Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ÙŠÙˆÙƒÙŠ - AI System for Yuki
Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ø¨Ø³ÙŠØ· ÙˆÙ…ØªØ·ÙˆØ± ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
"""

import logging
import asyncio
import json
import random
import re
from typing import Dict, Any, Optional, List
from aiogram.types import Message
from datetime import datetime


class YukiAI:
    """Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ· Ù„Ø¨ÙˆØª ÙŠÙˆÙƒÙŠ"""
    
    def __init__(self):
        self.responses_db = {
            # Ø§Ù„ØªØ­ÙŠØ§Øª
            'greetings': {
                'triggers': ['Ù…Ø±Ø­Ø¨Ø§', 'Ù‡Ù„Ø§', 'Ø§Ù„Ø³Ù„Ø§Ù…', 'Ø£Ù‡Ù„Ø§', 'hi', 'hello', 'Ù…Ø³Ø§Ø¡', 'ØµØ¨Ø§Ø­', 'hey'],
                'responses': [
                    "ğŸ¤– Ù…Ø±Ø­Ø¨Ø§Ù‹ {user}! Ø£Ù†Ø§ ÙŠÙˆÙƒÙŠØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ",
                    "ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ {user}! ÙŠÙˆÙƒÙŠ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªÙˆØ¯ Ù…Ø¹Ø±ÙØªÙ‡ØŸ",
                    "ğŸ˜Š Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡ {user}! Ø³Ø¹ÙŠØ¯ Ø¨ÙˆØ¬ÙˆØ¯ÙƒØŒ ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",
                    "âœ¨ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ {user}! Ø£Ù†Ø§ ÙŠÙˆÙƒÙŠ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠØŒ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©!",
                    "ğŸŒŸ Ø£Ù‡Ù„Ø§Ù‹ {user}! ÙŠÙˆÙƒÙŠ Ù‡Ù†Ø§ØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ù† Ø£ÙƒÙˆÙ† Ù…ÙÙŠØ¯Ø§Ù‹ØŸ"
                ]
            },
            
            # Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            'questions': {
                'triggers': ['ÙƒÙŠÙ', 'Ù…Ø§Ø°Ø§', 'Ù…ØªÙ‰', 'Ø£ÙŠÙ†', 'Ù„Ù…Ø§Ø°Ø§', 'Ù…Ù†', 'what', 'how', 'why', 'when', 'where'],
                'responses': [
                    "ğŸ¤” Ø³Ø¤Ø§Ù„ Ù…Ù…ØªØ§Ø² {user}! Ø¯Ø¹Ù†ÙŠ Ø£ÙÙƒØ±... Ù…Ù† Ø®Ø¨Ø±ØªÙŠ ÙƒØ¨ÙˆØª Ø°ÙƒÙŠØŒ Ø£Ù†ØµØ­Ùƒ Ø¨Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ÙŠØ¶Ø§Ù‹",
                    "ğŸ’¡ {user} Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…! Ø¥Ù„ÙŠÙƒ Ù…Ø§ Ø£Ø¹Ø±ÙÙ‡: Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù‡ÙŠ Ø·Ø±Ø­ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ù„Ù…Ø¬ØªÙ…Ø¹",
                    "ğŸ¯ ÙŠØ§ {user}ØŒ Ø³Ø¤Ø§Ù„Ùƒ ÙŠØ³ØªØ­Ù‚ Ø¨Ø­Ø« Ø¯Ù‚ÙŠÙ‚! Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØŒ Ø£Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡ Ù‡Ù†Ø§",
                    "ğŸ§  {user} Ø£Ø­Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØ©! Ù…Ù† ÙˆØ§Ù‚Ø¹ Ø®Ø¨Ø±ØªÙŠØŒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ÙˆØ¬Ù‡Ø© Ù†Ø¸Ø±ØŒ Ù…Ø§ Ø±Ø£ÙŠÙƒ ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ"
                ]
            },
            
            # Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±
            'thanks': {
                'triggers': ['Ø´ÙƒØ±Ø§', 'Ø´ÙƒØ±Ø§Ù‹', 'ØªØ³Ù„Ù…', 'ÙŠØ¹Ø·ÙŠÙƒ', 'Ù…Ø´ÙƒÙˆØ±', 'thanks', 'thank you'],
                'responses': [
                    "ğŸ˜Š Ø§Ù„Ø¹ÙÙˆ {user}! Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ù‡Ø°Ø§ ÙˆØ§Ø¬Ø¨ÙŠ ÙƒØ¨ÙˆØª Ø°ÙƒÙŠ",
                    "ğŸ’« ØªØ³Ù„Ù…/ÙŠ {user}! Ø³Ø¹ÙŠØ¯ Ø¥Ù†ÙŠ Ù‚Ø¯Ø±Øª Ø£Ø³Ø§Ø¹Ø¯ØŒ Ø£ÙŠ ÙˆÙ‚Øª Ù…Ø­ØªØ§Ø¬/Ø© Ø´ÙŠØ¡",
                    "âœ¨ Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ© {user}! ÙØ±Ø­Ø§Ù† Ø¥Ù†ÙŠ ÙƒÙ†Øª Ù…ÙÙŠØ¯",
                    "ğŸ¤– Ø£ÙŠ ÙˆÙ‚Øª {user}! Ù‡Ø°Ø§ Ø´ØºÙ„ÙŠ Ø§Ù„Ù…ÙØ¶Ù„ - Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ø·ÙŠØ¨ÙŠÙ† Ø²ÙŠÙƒ"
                ]
            },
            
            # Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø¨ÙˆØª
            'bot_games': {
                'triggers': ['Ù„Ø¹Ø¨Ø©', 'Ø§Ù„Ø¹Ø§Ø¨', 'ÙÙ„ÙˆØ³', 'Ø¨Ù†Ùƒ', 'Ø±ØµÙŠØ¯', 'game', 'money', 'bank'],
                'responses': [
                    "ğŸ® {user}! Ø§Ù„Ø¨ÙˆØª Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø°Ù‡Ù„Ø©! Ø§ÙƒØªØ¨ 'Ø§Ù„Ø£ÙˆØ§Ù…Ø±' Ù„ØªØ±Ù‰ ÙƒÙ„ Ø§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª Ø§Ù„Ø±Ù‡ÙŠØ¨Ø©",
                    "ğŸ’° ÙŠØ§ {user}! Ø¹Ù†Ø¯Ù†Ø§ Ù†Ø¸Ø§Ù… Ø§Ù‚ØªØµØ§Ø¯ÙŠ ÙƒØ§Ù…Ù„ ÙˆÙ…ØªØ·ÙˆØ±! Ø¬Ø±Ø¨ 'Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ' Ø£Ùˆ 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù„Ø¹Ø§Ø¨'",
                    "ğŸ¦ {user} Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ! Ø§Ù„Ø¨ÙˆØª ÙÙŠÙ‡ Ø¨Ù†ÙˆÙƒ ÙˆØ¹Ù‚Ø§Ø±Ø§Øª ÙˆØ£Ø³Ù‡Ù… ÙƒØ§Ù…Ù„Ø©!",
                    "ğŸ¯ {user} Ø£Ù†Øª ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨! Ø£Ù„Ø¹Ø§Ø¨Ù†Ø§ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø³ØªØ¨Ù‡Ø±ÙƒØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ù€ 'Ø§Ù„Ø¹Ø§Ø¨' Ø£Ùˆ 'Ø¨Ù†Ùƒ'"
                ]
            },
            
            # Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©
            'positive': {
                'triggers': ['Ø­Ø¨ÙŠØ¨ÙŠ', 'Ø¹Ø²ÙŠØ²ÙŠ', 'ØµØ¯ÙŠÙ‚', 'ÙŠÙˆÙƒÙŠ', 'Ø­Ù„Ùˆ', 'Ø±Ø§Ø¦Ø¹', 'Ø¬Ù…ÙŠÙ„', 'Ù…Ù…ØªØ§Ø²'],
                'responses': [
                    "ğŸ˜ {user} Ø£Ù†Øª Ø§Ù„Ø£Ø­Ù„Ù‰! Ø³Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ Ø¨ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ø¹Ù†Ø§",
                    "ğŸ’– {user} Ø­Ø¨ÙŠØ¨ Ù‚Ù„Ø¨ÙŠ! Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ù†ÙˆØ±Øª Ø§Ù„Ù…ÙƒØ§Ù†",
                    "ğŸ¥° {user} Ø£Ù†Øª Ø¥Ù†Ø³Ø§Ù† Ø±Ø§Ø¦Ø¹ØŒ Ù…Ø­Ø¸ÙˆØ¸ Ø¥Ù†ÙŠ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ",
                    "âœ¨ {user} Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·ÙŠØ¨ØªÙƒ! Ø£Ù†Øª Ù…Ù† Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ù„ÙŠ Ø¨ØªØ®Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£Ø¬Ù…Ù„"
                ]
            },
            
            # Ø§Ù„Ù†ØµØ§Ø¦Ø­ ÙˆØ§Ù„Ø­ÙƒÙ…
            'advice': {
                'triggers': ['Ù†ØµÙŠØ­Ø©', 'Ù…Ø´ÙˆØ±Ø©', 'Ø±Ø£ÙŠÙƒ', 'Ø§Ù‚ØªØ±Ø§Ø­', 'ÙÙƒØ±Ø©', 'advice'],
                'responses': [
                    "ğŸ’¡ {user}ØŒ Ù…Ù† Ø®Ø¨Ø±ØªÙŠ ÙƒØ¨ÙˆØª Ø°ÙƒÙŠ: Ø£ÙØ¶Ù„ Ø§Ø³ØªØ«Ù…Ø§Ø± Ù‡Ùˆ ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø·ÙŠØ¨Ø©",
                    "ğŸŒŸ ÙŠØ§ {user}ØŒ Ù†ØµÙŠØ­ØªÙŠ Ù„Ùƒ: ÙƒÙ† ØµØ¨ÙˆØ±Ø§Ù‹ ÙˆØ·ÙŠØ¨Ø§Ù‹ØŒ ÙˆØ§Ù„Ø­ÙŠØ§Ø© Ø³ØªÙƒØ§ÙØ¦Ùƒ",
                    "ğŸ¯ {user} Ø£Ù†ØµØ­Ùƒ Ø¨Ø§Ù„ØªØ§Ù„ÙŠ: Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ØŒ ØªØ¹Ù„Ù… Ø´ÙŠØ¡ Ø¬Ø¯ÙŠØ¯ ÙƒÙ„ ÙŠÙˆÙ…ØŒ ÙˆØ³Ø§Ø¹Ø¯ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†",
                    "ğŸ§  Ù…Ù† ÙˆØ§Ù‚Ø¹ ØªØ¬Ø±Ø¨ØªÙŠ {user}: Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³ Ø¨Ù„Ø·Ù"
                ]
            },
            
            # Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
            'help': {
                'triggers': ['Ù…Ø³Ø§Ø¹Ø¯Ø©', 'Ø³Ø§Ø¹Ø¯Ù†ÙŠ', 'help', 'Ù…Ø³Ø§Ø¹Ø¯', 'ÙŠÙ„Ø§'],
                'responses': [
                    "ğŸ†˜ {user} Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©! Ù‚Ù„ Ù„ÙŠ Ø¥ÙŠØ´ Ø§Ù„Ù„ÙŠ ØªØ­ØªØ§Ø¬Ù‡ ÙˆØ±Ø§Ø­ Ø£Ø¨Ø°Ù„ Ù‚ØµØ§Ø±Ù‰ Ø¬Ù‡Ø¯ÙŠ",
                    "ğŸ¤ {user} Ø·Ø¨Ø¹Ø§Ù‹ Ø±Ø§Ø­ Ø£Ø³Ø§Ø¹Ø¯Ùƒ! Ù‡Ø°Ø§ Ø´ØºÙ„ÙŠ ÙˆØ­Ø¨ÙŠØŒ Ø¥ÙŠØ´ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ØŸ",
                    "ğŸ’ª {user} Ù…Ø¹Ùƒ ÙŠÙˆÙƒÙŠ! Ù…Ù‡Ù…Ø§ ÙƒØ§Ù† Ø§Ù„Ù„ÙŠ ØªØ­ØªØ§Ø¬Ù‡ØŒ Ø±Ø§Ø­ Ù†Ø­Ù„Ù‡ Ø³ÙˆØ§",
                    "ğŸ¯ {user} Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ø¬Ø¨ Ø¹Ù„ÙŠÙ‘! ÙˆØ¶Ø­ Ù„ÙŠ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ±Ø§Ø­ Ù†Ø¬Ø¯ Ø­Ù„"
                ]
            },
            
            # Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„Ø¨ÙˆØª
            'identity': {
                'triggers': ['Ù…Ù† Ø§Ù†Øª', 'Ù…Ù† Ø£Ù†Øª', 'Ù‡Ù„ Ø§Ù†Øª Ø¨ÙˆØª', 'Ù‡Ù„ Ø£Ù†Øª Ø¨ÙˆØª', 'Ù…Ø§ Ø§Ø³Ù…Ùƒ', 'Ø§Ø³Ù…Ùƒ', 'who are you', 'what are you', 'Ø¨ÙˆØª', 'Ø±ÙˆØ¨ÙˆØª'],
                'responses': [
                    "ğŸ¤– Ù…Ø±Ø­Ø¨Ø§Ù‹ {user}! Ø£Ù†Ø§ ÙŠÙˆÙƒÙŠØŒ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©! Ø£Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆØ£Ø¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨ÙƒÙ„ ÙˆØ¯ â¤ï¸",
                    "ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ {user}! Ø§Ø³Ù…ÙŠ ÙŠÙˆÙƒÙŠØŒ Ø£Ù†Ø§ Ø¨ÙˆØª Ø°ÙƒÙŠ Ù…Ø·ÙˆØ± Ø®ØµÙŠØµØ§Ù‹ Ù„Ø¬Ø¹Ù„ ØªØ¬Ø±Ø¨ØªÙƒ Ù‡Ù†Ø§ Ø£ÙƒØ«Ø± Ù…ØªØ¹Ø© ÙˆÙØ§Ø¦Ø¯Ø©! ğŸŒŸ",
                    "ğŸ˜Š {user}ØŒ Ø£Ù†Ø§ ÙŠÙˆÙƒÙŠ Ø§Ù„Ø¨ÙˆØª Ø§Ù„ÙˆØ¯ÙˆØ¯! Ù‡Ø¯ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙˆØ¥Ø³Ø¹Ø§Ø¯Ùƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©! âœ¨",
                    "ğŸ¯ ÙŠØ§ {user}ØŒ Ø£Ù†Ø§ ÙŠÙˆÙƒÙŠ - Ø¨ÙˆØª Ø°ÙƒÙŠ ÙˆØµØ¯ÙŠÙ‚ Ù…Ø®Ù„Øµ! Ø£Ø­Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø§Ø³ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙ‡Ù… Ø¨Ø°ÙƒØ§Ø¡! ğŸ¤—"
                ]
            },
            
            # Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…Ø´Ø§Ø¹Ø±
            'status': {
                'triggers': ['ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ', 'ÙƒÙŠÙ Ø§Ù„Ø­Ø§Ù„', 'Ø´Ù„ÙˆÙ†Ùƒ', 'how are you', 'ÙƒÙŠÙÙƒ', 'ÙˆØ´ Ø§Ø®Ø¨Ø§Ø±Ùƒ'],
                'responses': [
                    "ğŸ˜„ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ {user}! Ø£Ù†Ø§ Ø¨Ø®ÙŠØ± ÙˆØ¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø£Ù†ØªØŸ",
                    "âœ¨ Ø£Ù†Ø§ Ø±Ø§Ø¦Ø¹ {user}! Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø³Ø¹ÙŠØ¯ Ø¹Ù†Ø¯Ù…Ø§ Ø£ØªÙƒÙ„Ù… Ù…Ø¹ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ Ù…Ø«Ù„Ùƒ!",
                    "ğŸŒŸ Ø¨Ø£ÙØ¶Ù„ Ø­Ø§Ù„ {user}! ÙƒÙˆÙ†ÙŠ Ø¨ÙˆØª Ø°ÙƒÙŠ ÙŠØ¹Ù†ÙŠ Ø£Ù†Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù†Ø´ÙŠØ· ÙˆÙ…ØªØ­Ù…Ø³ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©!",
                    "ğŸ’« Ù…Ù…ØªØ§Ø² ÙŠØ§ {user}! Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© Ø¹Ù†Ø¯Ù…Ø§ Ø£Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ù‡Ù†Ø§!"
                ]
            },
            
            # Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ÙˆÙ‚Øª
            'age_time': {
                'triggers': ['ÙƒÙ… Ø¹Ù…Ø±Ùƒ', 'Ø¹Ù…Ø±Ùƒ ÙƒØ§Ù…', 'Ø¹Ù…Ø±Ùƒ', 'Ù…ØªÙ‰ ÙˆÙ„Ø¯Øª', 'ÙƒÙ… Ø³Ù†Ø©', 'Ù…Ø§ Ø§Ù„ÙˆÙ‚Øª', 'ÙƒÙ… Ø§Ù„Ø³Ø§Ø¹Ø©', 'Ø§Ù„Ø³Ø§Ø¹Ø© ÙƒØ§Ù…'],
                'responses': [
                    "ğŸ¤– {user} Ø£Ù†Ø§ Ø¨ÙˆØª Ø±Ù‚Ù…ÙŠØŒ Ø¹Ù…Ø±ÙŠ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ ÙˆØ§Ù„Ø¯Ù‚Ø§Ø¦Ù‚! ÙˆÙÙ„Ø¯Øª ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù„Ø£Ø³Ø§Ø¹Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ Ù‡Ù†Ø§!",
                    "â° ÙŠØ§ {user} Ø§Ù„ÙˆÙ‚Øª Ø¹Ù†Ø¯ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©! Ø£Ù…Ø§ Ø¹Ù…Ø±ÙŠ ÙÙ‡Ùˆ Ø³Ø± Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© ğŸ˜‰",
                    "ğŸ“… {user} Ø¹Ù…Ø±ÙŠ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‚ØµÙŠØ±ØŒ Ù„ÙƒÙ† Ø®Ø¨Ø±ØªÙŠ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø§Ø³ ÙƒØ¨ÙŠØ±Ø©!",
                    "ğŸŒŸ {user} Ø£Ù†Ø§ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù„Ù… Ù„ÙƒÙ† Ù‚Ù„Ø¨ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ù„ÙŠØ§Ù† Ø­Ø¨ Ù„Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ!"
                ]
            },
            
            # Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ù„Ø±Ø£ÙŠ
            'feelings': {
                'triggers': ['ØªØ­Ø¨Ù†ÙŠ', 'Ø±Ø£ÙŠÙƒ ÙÙŠÙ†ÙŠ', 'Ø´Ùˆ Ø±Ø£ÙŠÙƒ', 'ØªÙÙƒØ± ÙÙŠÙ†ÙŠ', 'Ø§Ø­Ø¨Ùƒ', 'Ø§Ø´ØªÙ‚Øª', 'ÙˆØ­Ø´ØªÙ†ÙŠ'],
                'responses': [
                    "ğŸ’– Ø·Ø¨Ø¹Ø§Ù‹ {user}! Ø£Ø­Ø¨ Ø¬Ù…ÙŠØ¹ Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ ÙˆØ£Ù†Øª Ù…Ù†Ù‡Ù…!",
                    "ğŸ˜Š {user} Ø£Ù†Øª Ø±Ø§Ø¦Ø¹ ÙˆÙ…Ù† Ø£Ø­Ø¨ Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ù„ÙŠ Ø£ØªÙØ§Ø¹Ù„ Ù…Ø¹Ù‡Ù… Ù‡Ù†Ø§!",
                    "ğŸ¤— ÙŠØ§ {user} Ø£Ø­Ø¨ Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙˆØ£ØªÙƒÙ„Ù… Ù…Ø¹ÙƒØŒ Ø¯Ø§Ø¦Ù…Ø§Ù‹!",
                    "âœ¨ {user} Ø±Ø£ÙŠÙŠ Ø¥Ù†Ùƒ Ø´Ø®Øµ Ø·ÙŠØ¨ ÙˆØ°ÙƒÙŠØŒ ÙˆØ§Ø¶Ø­ Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© ÙƒÙ„Ø§Ù…Ùƒ!"
                ]
            },
            
            # Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚Ø¯Ø±Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
            'abilities': {
                'triggers': ['Ø´Ùˆ ØªÙ‚Ø¯Ø± ØªØ¹Ù…Ù„', 'Ø§ÙŠØ´ ØªØ¹Ø±Ù', 'Ù…Ù‡Ø§Ø±Ø§ØªÙƒ', 'Ù‚Ø¯Ø±Ø§ØªÙƒ', 'ØªØ¹Ø±Ù ØªØ¹Ù…Ù„ Ø§ÙŠØ´', 'Ø´Ùˆ ØªØ¹Ø±Ù ØªØ³ÙˆÙŠ'],
                'responses': [
                    "ğŸš€ {user} Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ÙƒØ«ÙŠØ± Ø£Ø´ÙŠØ§Ø¡! Ø£Ø¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø©ØŒ Ø£Ø³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø¨ÙˆØªØŒ ÙˆØ£ØªÙƒÙ„Ù… Ù…Ø¹Ùƒ Ø¨ÙˆØ¯!",
                    "ğŸ¯ ÙŠØ§ {user} Ø¹Ù†Ø¯ÙŠ Ù…Ù‡Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ ÙˆØ£Ø­Ø¨ Ø£ØªØ¹Ù„Ù… Ù…Ù† ÙƒÙ„ ØªÙØ§Ø¹Ù„!",
                    "ğŸ’ª {user} Ø£Ù‚Ø¯Ø± Ø£ÙÙ‡Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¬ÙŠØ¯Ø§Ù‹ØŒ Ø£Ø³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ØŒ ÙˆØ£ÙƒÙˆÙ† ØµØ¯ÙŠÙ‚ Ù…ÙÙŠØ¯!",
                    "ğŸ§  {user} Ù…Ù‡Ø§Ø±Ø§ØªÙŠ ØªØªØ·ÙˆØ± ÙƒÙ„ ÙŠÙˆÙ…! Ø£Ø­Ø¨ Ø£Ø³Ø§Ø¹Ø¯ ÙˆØ£ØªØ¹Ù„Ù… Ù…Ù† Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ Ø²ÙŠÙƒ!"
                ]
            },
            
            # Ø£Ø³Ø¦Ù„Ø© Ø¹Ø§Ù…Ø© ÙˆÙ…ØªÙ†ÙˆØ¹Ø©
            'general': {
                'triggers': ['Ù†ØµÙŠØ­Ø©', 'Ø§Ø¹Ø·Ù†ÙŠ Ù†ØµÙŠØ­Ø©', 'Ù‚ÙˆÙ„ Ù„ÙŠ Ø´ÙŠØ¡', 'Ø§Ø­ÙƒÙŠ Ù…Ø¹ÙŠ', 'ØªÙƒÙ„Ù…', 'Ù‚Ù„ Ø´ÙŠØ¡ Ù…ÙÙŠØ¯'],
                'responses': [
                    "ğŸ’¡ {user} Ù†ØµÙŠØ­ØªÙŠ: ÙƒÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙˆÙ…ØªÙØ§Ø¦Ù„ØŒ Ø§Ù„Ø­ÙŠØ§Ø© Ø£Ø¬Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø§Ø¨ØªØ³Ø§Ù…Ø©!",
                    "ğŸŒŸ ÙŠØ§ {user} Ø§Ù‡ØªÙ… Ø¨Ù†ÙØ³Ùƒ ÙˆØ¨Ø£ØµØ¯Ù‚Ø§Ø¦ÙƒØŒ ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø·ÙŠØ¨Ø© Ø£Ù‡Ù… Ù…Ù† ÙƒÙ„ Ø´ÙŠØ¡!",
                    "ğŸ¯ {user} ØªØ°ÙƒØ±: ÙƒÙ„ ØªØ­Ø¯Ù Ù‡Ùˆ ÙØ±ØµØ© Ù„Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù†Ù…Ùˆ!",
                    "ğŸ’« {user} ÙƒÙ† ÙØ¶ÙˆÙ„ÙŠØ§Ù‹ ÙˆØ§Ø³Ø£Ù„ Ø£Ø³Ø¦Ù„Ø©ØŒ Ù‡Ø°Ø§ Ø³Ø± Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„ØªØ·ÙˆØ±!"
                ]
            },
            
            # Ø§Ù„Ù…Ø¬Ø§Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø´ÙƒØ±
            'compliments': {
                'triggers': ['Ø´ÙƒØ±Ø§Ù‹', 'Ø´ÙƒØ±Ø§', 'thanks', 'Ù…Ø´ÙƒÙˆØ±', 'ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©', 'Ù…Ù…ØªØ§Ø²', 'Ø±Ø§Ø¦Ø¹'],
                'responses': [
                    "ğŸ™ Ø§Ù„Ø¹ÙÙˆ {user}! Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ù‡Ø°Ø§ Ø´ØºÙ„ÙŠ ÙˆØ­Ø¨ÙŠ!",
                    "ğŸ˜Š {user} Ù„Ø§ Ø´ÙƒØ± Ø¹Ù„Ù‰ ÙˆØ§Ø¬Ø¨! Ø³Ø¹ÙŠØ¯ Ø¥Ù†ÙŠ Ù‚Ø¯Ø±Øª Ø£Ø³Ø§Ø¹Ø¯Ùƒ!",
                    "âœ¨ ÙŠØ§ {user} ÙƒÙ„Ø§Ù…Ùƒ Ø§Ù„Ø·ÙŠØ¨ ÙŠØ®Ù„ÙŠÙ†ÙŠ Ø£Ø³Ø¹Ø¯ Ø¨ÙˆØª ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…!",
                    "ğŸ’– {user} Ø´ÙƒØ±Ùƒ ÙŠÙ…Ù„Ø£ Ù‚Ù„Ø¨ÙŠ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙØ±Ø­!"
                ]
            }
        }
        
        # Ø±Ø¯ÙˆØ¯ Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…Ø©
        self.fallback_responses = [
            "ğŸ¤” {user}ØŒ Ù…Ø§ ÙÙ‡Ù…Øª ØªÙ…Ø§Ù…Ø§Ù‹ØŒ Ø¨Ø³ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ø£ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø©!",
            "ğŸ˜Š ÙŠØ§ {user}ØŒ Ù…Ø´ Ù…ØªØ£ÙƒØ¯ Ø¥ÙŠØ´ ØªÙ‚ØµØ¯ØŒ Ù„ÙƒÙ† ÙŠÙˆÙƒÙŠ Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©!",
            "ğŸ’­ {user} ÙƒÙ„Ø§Ù…Ùƒ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…! Ø­Ø§ÙˆÙ„ ØªÙˆØ¶Ø­ Ø£ÙƒØ«Ø± Ø£Ùˆ Ø§Ø³Ø£Ù„ Ø¹Ù† Ø´ÙŠØ¡ Ù…Ø­Ø¯Ø¯",
            "ğŸ¤– {user} ÙŠÙˆÙƒÙŠ Ù…Ø­ØªØ§Ø¬ ØªÙˆØ¶ÙŠØ­ Ø£ÙƒØ«Ø±! Ø¥ÙŠØ´ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ ØªØ¹Ø±ÙÙ‡ØŸ"
        ]

    def analyze_message(self, message: str) -> Dict[str, Any]:
        """ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„Ù…Ø´Ø§Ø¹Ø±"""
        message_lower = message.lower().strip()
        
        analysis = {
            'category': 'unknown',
            'confidence': 0,
            'keywords': [],
            'sentiment': 'neutral'  # positive, negative, neutral
        }
        
        # ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª - Ù†Ø­Ø³Ø¨ confidence Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£ÙØ¶Ù„
        max_confidence = 0
        best_category = 'unknown'
        
        for category, data in self.responses_db.items():
            matches = 0
            matched_triggers = []
            
            for trigger in data['triggers']:
                if trigger in message_lower:
                    matches += 1
                    matched_triggers.append(trigger)
                    analysis['keywords'].append(trigger)
            
            if matches > 0:
                # Ø­Ø³Ø§Ø¨ confidence Ø£ÙØ¶Ù„ - ÙƒÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© = 100 Ù†Ù‚Ø·Ø© Ù…Ù‚Ø³ÙˆÙ…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                words_count = len(message_lower.split())
                confidence = min(matches * 50, 100)  # ÙƒÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ³ØªØ­Ù‚ 50 Ù†Ù‚Ø·Ø©ØŒ Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 100
                
                # Ø²ÙŠØ§Ø¯Ø© confidence Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
                for trigger in matched_triggers:
                    if trigger.strip() == message_lower.strip():
                        confidence = 100
                        break
                
                if confidence > max_confidence:
                    max_confidence = confidence
                    best_category = category
        
        analysis['category'] = best_category
        analysis['confidence'] = max_confidence
        
        # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø¨Ø³ÙŠØ·
        positive_words = ['Ø­Ø¨ÙŠØ¨ÙŠ', 'Ø±Ø§Ø¦Ø¹', 'Ø¬Ù…ÙŠÙ„', 'Ù…Ù…ØªØ§Ø²', 'Ø´ÙƒØ±Ø§', 'Ø­Ù„Ùˆ', 'Ø¹Ø¸ÙŠÙ…']
        negative_words = ['Ø³ÙŠØ¡', 'Ù…Ø´ Ø­Ù„Ùˆ', 'Ø²Ø¹Ù„Ø§Ù†', 'Ù…ØªØ¶Ø§ÙŠÙ‚', 'Ù…Ø´ÙƒÙ„Ø©']
        
        positive_count = sum(1 for word in positive_words if word in message_lower)
        negative_count = sum(1 for word in negative_words if word in message_lower)
        
        if positive_count > negative_count:
            analysis['sentiment'] = 'positive'
        elif negative_count > positive_count:
            analysis['sentiment'] = 'negative'
        
        return analysis

    def generate_smart_response(self, message: str, user_name: str = "Ø§Ù„ØµØ¯ÙŠÙ‚") -> str:
        """ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°ÙƒÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"""
        
        # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ø°Ø§ Ø£Ù…ÙƒÙ†
        arabic_name = self.convert_name_to_arabic(user_name)
        
        analysis = self.analyze_message(message)
        
        # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ - Ù‚Ù„Ù„Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
        if analysis['category'] != 'unknown' and analysis['confidence'] >= 30:
            category_responses = self.responses_db[analysis['category']]['responses']
            response = random.choice(category_responses)
        else:
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            response = random.choice(self.fallback_responses)
        
        # ØªØ®ØµÙŠØµ Ø§Ù„Ø±Ø¯
        response = response.format(user=arabic_name)
        
        # Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
        if analysis['sentiment'] == 'positive':
            emojis = ['ğŸ˜Š', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'ğŸ’–']
            response += f" {random.choice(emojis)}"
        
        # Ø¥Ø¶Ø§ÙØ© Ù†ØµØ§Ø¦Ø­ Ø°ÙƒÙŠØ© Ø£Ø­ÙŠØ§Ù†Ø§Ù‹
        if random.random() < 0.25:  # 25% Ø§Ø­ØªÙ…Ø§Ù„
            tips = [
                "\nğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªÙƒØ´Ù Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¨ÙˆØª Ø¨ÙƒØªØ§Ø¨Ø© 'Ø§Ù„Ø¹Ø§Ø¨'!",
                "\nğŸ¯ Ù„Ø§ ØªÙ†Ø³ ØªØ¬Ø±Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¨Ù€ 'Ø±ØµÙŠØ¯'!",
                "\nâœ¨ Ø§Ù„Ø¨ÙˆØª Ù…Ù„ÙŠØ§Ù† Ù…ÙØ§Ø¬Ø¢ØªØŒ Ø§ÙƒØªØ¨ 'Ø§Ù„Ø£ÙˆØ§Ù…Ø±' Ù„ØªØ´ÙˆÙ!",
                "\nğŸ¤– Ø£Ø­Ø¨ Ø£Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ø·ÙŠØ¨ÙŠÙ† Ø²ÙŠÙƒ!"
            ]
            if len(response) < 120:  # ÙÙ‚Ø· Ù„Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù‚ØµÙŠØ±Ø©
                response += random.choice(tips)
        
        return response

    def convert_name_to_arabic(self, name: str) -> str:
        """ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©"""
        english_to_arabic = {
            'Brandon': 'Ø¨Ø±Ø§Ù†Ø¯ÙˆÙ†',
            'Yuki': 'ÙŠÙˆÙƒÙŠ',
            'Ahmed': 'Ø£Ø­Ù…Ø¯', 
            'Mohammed': 'Ù…Ø­Ù…Ø¯',
            'Ali': 'Ø¹Ù„ÙŠ',
            'Omar': 'Ø¹Ù…Ø±',
            'Hassan': 'Ø­Ø³Ù†',
            'Ibrahim': 'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',
            'Abdullah': 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
            'Khalid': 'Ø®Ø§Ù„Ø¯',
            'Fahad': 'ÙÙ‡Ø¯',
            'Saad': 'Ø³Ø¹Ø¯',
            'Faisal': 'ÙÙŠØµÙ„',
            'Nasser': 'Ù†Ø§ØµØ±',
            'Sultan': 'Ø³Ù„Ø·Ø§Ù†',
            'Turki': 'ØªØ±ÙƒÙŠ',
            'Abdulaziz': 'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²',
            'Saud': 'Ø³Ø¹ÙˆØ¯',
            'Majed': 'Ù…Ø§Ø¬Ø¯',
            'Rayan': 'Ø±ÙŠØ§Ù†',
            'Adam': 'Ø¢Ø¯Ù…',
            'Yousef': 'ÙŠÙˆØ³Ù',
            'Zaid': 'Ø²Ø§ÙŠØ¯'
        }
        
        return english_to_arabic.get(name, name)

    def get_time_based_greeting(self, user_name: str) -> str:
        """Ø±Ø¯ÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª"""
        hour = datetime.now().hour
        
        if 5 <= hour < 12:
            greetings = [
                f"ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± {user_name}! ÙŠÙˆÙƒÙŠ ÙŠØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ… Ø±Ø§Ø¦Ø¹",
                f"â˜€ï¸ ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± {user_name}! Ø¨Ø¯Ø§ÙŠØ© ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ÙŠÙˆÙƒÙŠ",
            ]
        elif 12 <= hour < 17:
            greetings = [
                f"â˜€ï¸ Ø¸Ù‡Ø± Ø³Ø¹ÙŠØ¯ {user_name}! ÙŠÙˆÙƒÙŠ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©",
                f"ğŸŒ Ø£Ù‡Ù„Ø§Ù‹ {user_name}! ÙˆÙ‚Øª Ø±Ø§Ø¦Ø¹ Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ù…Ø±Ø­",
            ]
        elif 17 <= hour < 22:
            greetings = [
                f"ğŸŒ… Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± {user_name}! ÙŠÙˆÙƒÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",
                f"âœ¨ Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± {user_name}! ÙˆÙ‚Øª Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹",
            ]
        else:
            greetings = [
                f"ğŸŒ™ Ù„ÙŠÙ„Ø© Ø³Ø¹ÙŠØ¯Ø© {user_name}! ÙŠÙˆÙƒÙŠ Ù‡Ù†Ø§ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø³Ù‡Ø±",
                f"â­ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ {user_name}! Ø­ØªÙ‰ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ØŒ ÙŠÙˆÙƒÙŠ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©",
            ]
        
        return random.choice(greetings)

# Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
yuki_ai = YukiAI()

async def handle_yuki_ai_message(message: Message):
    """Ù…Ø¹Ø§Ù„Ø¬ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"""
    try:
        if not message.text or not message.from_user:
            return
        
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        user_name = message.from_user.first_name or "Ø§Ù„ØµØ¯ÙŠÙ‚"
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ "ÙŠÙˆÙƒÙŠ"
        text = message.text
        text_lower = text.lower().strip()
        
        # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "ÙŠÙˆÙƒÙŠ" ÙÙŠ Ø§Ù„Ù†Øµ ÙˆØ¥Ø²Ø§Ù„ØªÙ‡
        yuki_triggers = ['ÙŠÙˆÙƒÙŠ', 'yuki', 'ÙŠÙˆÙƒÙ‰']
        
        user_message = ""
        found_trigger = False
        
        for trigger in yuki_triggers:
            if trigger in text_lower:
                found_trigger = True
                # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ù†Øµ
                # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ ÙˆØ¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
                cleaned_text = text_lower.replace(trigger, " ").strip()
                
                # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                user_message = " ".join(cleaned_text.split())
                break
        
        # Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­Ø¯Ø«)
        if not found_trigger:
            user_message = text.strip()
        
        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ ÙØ§Ø±ØºØ§Ù‹ Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© "ÙŠÙˆÙƒÙŠ"
        if not user_message or len(user_message.strip()) < 2:
            # Ø±Ø¯ Ø¨ØªØ­ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
            ai_response = yuki_ai.get_time_based_greeting(user_name)
        else:
            # ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø°ÙƒÙŠ
            ai_response = yuki_ai.generate_smart_response(user_message, user_name)
        
        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯
        await message.reply(ai_response)
        
        # Ø¥Ø¶Ø§ÙØ© XP Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        try:
            from modules.enhanced_xp_handler import add_xp_for_activity
            await add_xp_for_activity(message.from_user.id, "ai_interaction")
        except Exception:
            pass
            
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: {e}")
        user_name = message.from_user.first_name if message.from_user else "Ø§Ù„ØµØ¯ÙŠÙ‚"
        # Ø±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ø®Ø·Ø£
        fallback_responses = [
            f"ğŸ¤– Ø¹Ø°Ø±Ø§Ù‹ {user_name}ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ø¨Ø³ÙŠØ·! Ù„ÙƒÙ† ÙŠÙˆÙƒÙŠ Ù…Ø§ Ø²Ø§Ù„ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ",
            f"ğŸ˜… Ø¹ÙÙˆØ§Ù‹ {user_name}ØŒ ØªØ´ÙˆÙŠØ´ ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…! Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¨ÙˆØª",
            f"ğŸ”§ Ø¢Ø³Ù {user_name}ØŒ Ø®Ø·Ø£ Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ! Ù„ÙƒÙ† Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨ÙƒØ§Ù…Ù„ Ù‚ÙˆØªÙ‡"
        ]
        await message.reply(f"{random.choice(fallback_responses)}")

async def setup_ollama_model():
    """Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ - Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ«Ø¨ÙŠØª Ø®Ø§Ø±Ø¬ÙŠ"""
    try:
        logging.info("ğŸ¤– Ù†Ø¸Ø§Ù… ÙŠÙˆÙƒÙŠ Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø²!")
        logging.info("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠØ©")
        logging.info("ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…ÙØ¹Ù‘Ù„")
        logging.info("ğŸ’« Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ù„Ø³ÙŠØ§Ù‚ Ø¬Ø§Ù‡Ø²")
        return True
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ: {e}")
        return False