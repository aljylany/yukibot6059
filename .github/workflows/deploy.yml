name: ๐ค ุจูุช ูููู ุงููุณุชูุฑ - ููุงุฆู
# ููู ุฌุงูุฒ ุจุฏูู GitHub Secrets - ุงูููุงุชูุญ ููุฏูุฌุฉ ูุจุงุดุฑุฉ

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

concurrency:
  group: yuki-telegram-bot
  cancel-in-progress: false

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: ๐ฅ ุณุญุจ ุงูููุฏ ุงูุฃุณุงุณู
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ๐ ุชุญููู Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: โ๏ธ ุชููุฆุฉ Git
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"

      - name: ๐พ ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุชุดุบูู ุงูุณุงุจู
        run: |
          echo "๐ฅ ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุจูุช ูู ูุฑุน ุงูุชุฎุฒูู..."
          if git fetch origin yuki-bot-storage 2>/dev/null; then
            echo "โ ุชู ุงูุนุซูุฑ ุนูู ูุฑุน ุชุฎุฒูู ุงูุจูุช"
            git checkout origin/yuki-bot-storage -- . 2>/dev/null || echo "โ๏ธ ูุง ุชูุฌุฏ ุจูุงูุงุช ุณุงุจูุฉ"
            echo "โ ุชู ุงุณุชุจุฏุงู ุงููููุงุช ุงููุฏููุฉ ุจูุณุฎุฉ ุงูุชุฎุฒูู"
          else
            echo "โ๏ธ ูุง ููุฌุฏ ูุฑุน ุชุฎุฒููุ ุณูุจุฏุฃ ุงูุจูุช ุจุจูุงูุงุช ุฌุฏูุฏุฉ"
          fi
          echo "๐ ุงูุชุญูู ูู ูููุงุช ุงูุจูุช ุจุนุฏ ุงูุชุญููู:"
          ls -la *.db *.json *.log *.txt 2>/dev/null || true

      - name: ๐ฆ ุชุซุจูุช ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          else
            echo "โ ููู requirements.txt ุบูุฑ ููุฌูุฏ!"
            exit 1
          fi

      - name: ๐ต ุชุซุจูุช ูุชุทูุจุงุช ุงูููุฏูุง
        run: |          
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          sudo apt-get install -y libcairo2-dev libpango1.0-dev libgdk-pixbuf-2.0-dev

      - name: ๐ค ุชุดุบูู ุจูุช ูููู ูุน ุงูููุงุชูุญ ุงูููุฏูุฌุฉ
        env:
          BOT_TOKEN: "7942168520:AAEj18WjZ8Ek6TEFdp5ZLjGIk5jSG5L8z0o"
          GOOGLE_API_KEY: "AIzaSyAnAc6MtS47ze-9VWWQz85OHpPpj_IR0Nw"
          GEMINI_API_KEY: "AIzaSyAnAc6MtS47ze-9VWWQz85OHpPpj_IR0Nw"
          GEMINI_API_KEY_1: "AIzaSyAnAc6MtS47ze-9VWWQz85OHpPpj_IR0Nw"
          GEMINI_API_KEY_2: "AIzaSyBIA3lxeRPNGSyAhNvwRgQOQne0xLwLFDU"
          GEMINI_API_KEY_3: "AIzaSyDfubP4RA1HNhRYPA_zdIL_yiOUez8i9q4"
          GEMINI_API_KEY_4: "AIzaSyAWdRjj2W3uO0UUXn1p3Ak3NcWIZsVyQGo"
          GEMINI_API_KEY_5: "AIzaSyBjgWmvJ35SiLW1Ml4O5AoKVaPl0lMod94"
          GEMINI_API_KEY_6: "AIzaSyDBj6s1hjxCze1Gm9lq4f6L_7i0vWU4-1c"
          GEMINI_API_KEY_7: "AIzaSyCvDL3TqpFW_HqYB_-cDiR8uPmlWpr3PHg"
          GEMINI_API_KEY_8: "AIzaSyCWFQ8ReXdV0BTK6ewy9abXMpRV2hZTtpw"
          GEMINI_API_KEY_9: "AIzaSyC-x4Y9i6LN-qMC4O_IBfRPgjNTXcfDu3M"
          GEMINI_API_KEY_10: "AIzaSyCGgK4HDEMEw1DgPtKHsdPrZXoYZh3J3uc"
          GEMINI_API_KEY_11: "AIzaSyACj8iQD_TF40Kq6bCEOdL9PTC80FNP0P4"
          GEMINI_API_KEY_12: "AIzaSyB5WnFWPMVzyBdfdqxrllAvsCNJJBIbcNI"
          GEMINI_API_KEY_13: "AIzaSyCCEVBmJZ4UOY6vdU-P8KVewOW0Zjvohsc"
          GEMINI_API_KEY_14: "AIzaSyA2T4ljXL8yEPLXewjROJufaPPov9RKCTg"
          GEMINI_API_KEY_15: "AIzaSyDJixY2cGRncwhLOILB2QltbaUHIp2enDk"
          GEMINI_API_KEY_16: "AIzaSyDZ6wNtpuVpXDHiBBbnGkKF5RznMul4yDE"
          YOUTUBE_API_KEY: "AIzaSyCM9c38ZRhBa1yoiaAij_EUioBzyMWeHa4"
          ANTHROPIC_API_KEY: ""
          OPENAI_API_KEY: ""
        run: |
          echo "๐ ุจุฏุก ุชุดุบูู ุจูุช ูููู..."
          echo "๐ค ุงุณู ุงูุจูุช: Yuki Telegram Bot"
          echo "๐ ุงูุฅุตุฏุงุฑ: 2.0 ุงููุญุณู"
          echo "โก ุญุงูุฉ ุงูุจูุช: ุฌุงุฑู ุงูุชุดุบูู ุงููุณุชูุฑ..."
          echo "๐ ููุช ุงูุจุฏุก: $(date)"
          echo ""
          echo "๐ ุงูููุงุชูุญ ุงูููุญููุฉ (ููุดููุฉ):"
          echo "  ๐ค BOT_TOKEN: 7942168520:AAEj18WjZ8Ek6TEFdp5ZLjGIk5jSG5L8z0o"
          echo "  ๐ง GOOGLE_API_KEY: AIzaSyAnAc6MtS47ze-9VWWQz85OHpPpj_IR0Nw"
          echo "  ๐บ YOUTUBE_API_KEY: AIzaSyCM9c38ZRhBa1yoiaAij_EUioBzyMWeHa4"
          echo "  ๐ข ููุงุชูุญ Gemini: 16 ููุชุงุญ ูุญููุฉ"
          echo ""
          echo "โ ูุง ุชูุฌุฏ ุฃู GitHub Secrets ูุทููุจุฉ - ุฌููุน ุงูููุงุชูุญ ููุฏูุฌุฉ!"
          echo "๐ฏ ุงูุจูุช ุฌุงูุฒ ููุนูู ุจูุงูู ููุชู..."
          echo ""
          python main.py

      - name: ๐พ ุญูุธ ุจูุงูุงุช ูุฐุง ุงูุชุดุบูู
        if: always()
        run: |
          echo "๐พ ุฌุงุฑู ุญูุธ ุจูุงูุงุช ุงูุจูุช..."
          git checkout main
          git checkout yuki-bot-storage 2>/dev/null || git checkout -b yuki-bot-storage
          
          # ุฅุถุงูุฉ ุงููููุงุช ุงููููุฉ ููู gitignore
          echo "# ูููุงุช ุงูุจูุช ุงููุณุชุซูุงุฉ ูู ุงูุญูุธ" > .gitignore
          echo "main.py" >> .gitignore
          echo "config/" >> .gitignore
          echo "handlers/" >> .gitignore
          echo "modules/" >> .gitignore
          echo "utils/" >> .gitignore
          echo "services/" >> .gitignore
          echo "requirements.txt" >> .gitignore
          echo ".github/" >> .gitignore
          echo "*.md" >> .gitignore
          echo "*.sh" >> .gitignore
          
          # ุญูุธ ูููุงุช ุงูุจูุงูุงุช ููุท
          git add *.db *.json *.log *.txt temp_media/ 2>/dev/null || true
          git add --all
          git commit -m "๐ค ุญูุธ ุชููุงุฆู ูุจูุงูุงุช ุงูุจูุช - $(date +'%Y-%m-%d %H:%M:%S')" || echo "โน๏ธ ูุง ุชูุฌุฏ ุชุบููุฑุงุช ููุญูุธ"
          git push origin yuki-bot-storage --force || echo "โ ูุดู ุฑูุน ุงูุจูุงูุงุช"
          git checkout main

      - name: โ ุชุฃููุฏ ุงูุชูุงุก ุงูุนูููุงุช
        if: always()
        run: |
          echo ""
          echo "๐ ููุฎุต ุงูุชุดุบูู ุงูููุงุฆู:"
          echo "โ ุงูุชูุช ุฌูุณุฉ ุชุดุบูู ุงูุจูุช ุจูุฌุงุญ"
          echo "๐พ ุงูุจูุงูุงุช ูุญููุธุฉ ูู ูุฑุน: yuki-bot-storage"
          echo "๐ ููุช ุงูุงูุชูุงุก: $(date)"
          echo "๐ ุงูุฌูุณุฉ ุงููุงุฏูุฉ: ุฎูุงู 6 ุณุงุนุงุช"
          echo "๐ ูุฏุฉ ุงูุชุดุบูู: 6 ุณุงุนุงุช (ุฃู ุญุชู ุงูุชูุงุก ุงูููุงู)"
          echo ""
          echo "๐ ุงูููุงุชูุญ ุงููุณุชุฎุฏูุฉ (ุจุฏูู ุฅุฎูุงุก):"
          echo "  ๐ค BOT_TOKEN: 7942168520:AAEj18WjZ8Ek6TEFdp5ZLjGIk5jSG5L8z0o"
          echo "  ๐ง GOOGLE_API_KEY: AIzaSyAnAc6MtS47ze-9VWWQz85OHpPpj_IR0Nw"
          echo "  ๐บ YOUTUBE_API_KEY: AIzaSyCM9c38ZRhBa1yoiaAij_EUioBzyMWeHa4"
          echo "  ๐ข ููุงุชูุญ Gemini: 16 ููุชุงุญ (GEMINI_API_KEY_1 ุฅูู GEMINI_API_KEY_16)"
          echo ""
          echo "๐ฏ ุญุงูุฉ ุงูุจูุช: ุฌุงูุฒ ููุฌูุณุฉ ุงููุงุฏูุฉ - ุจุฏูู ุฃู GitHub Secrets!"
          echo "โ ุชู ุญู ูุดููุฉ ุงูููุงุชูุญ ุงูููููุฏุฉ ููุงุฆูุงู"
