# 🤖 بوت يوكي - Yuki Bot

## 📋 نظرة عامة على المشروع
بوت تيليجرام ذكي ومتقدم يوفر ميزات متنوعة للمستخدمين في المجموعات بما في ذلك الذكاء الاصطناعي، الألعاب، الإدارة المالية، والأنظمة التفاعلية.

## 🔄 التحديثات الأخيرة (27 أغسطس 2025 - الجلسة الثالثة)

### 🎯 **إنجاز عملاق - نظام مراقبة واختبار شامل 100%:**

#### ✅ أوامر اختبار جديدة للتحقق من عمل النظام:
- **`/test_filter`** - اختبار شامل يعرض حالة النظام وجميع المعلومات التقنية مع اختبارات سريعة
- **`/test_profanity [النص]`** - اختبار كشف السباب لنص محدد مع نتائج مفصلة
- **`/monitor_filter`** - مراقبة مكثفة لمدة 30 ثانية لكل عملية فحص
- **`/reset_violations [معرف]`** - إعادة تعيين مخالفات مستخدم (السيد الأعلى فقط)

#### 🔍 نظام تسجيل مفصل للمراقبة الحية:
- **تسجيل تفاصيل المحتوى:** يسجل نوع كل محتوى قبل فحصه (نص، صورة، ملصق، فيديو)
- **تسجيل نتائج الفحص:** كل مخالفة مكتشفة تُسجل بالتفصيل مع مستوى الخطورة
- **تسجيل العمليات:** كل خطوة في عملية الفحص مُسجلة في console logs
- **مراقبة فورية:** يمكن مراقبة عمل النظام 100% في الوقت الفعلي

#### 📋 ملفات ودلائل جديدة:
- **`modules/content_filter_test_command.py`** - أوامر الاختبار والمراقبة المتقدمة
- **`test_monitoring_guide.md`** - دليل شامل للمراقبة والاختبار والتحقق من العمل 100%
- **تحديث `commands_list.txt`** - إضافة جميع أوامر الاختبار الجديدة
- **تحديث `اوامر يوكي.txt`** - أوامر الاختبار مع دليل الاستخدام المفصل

#### 🛠️ التحسينات التقنية:
- **تكامل محكم:** الأوامر الجديدة مُدمجة بالكامل في `handlers/commands.py`
- **صلاحيات محمية:** جميع أوامر الاختبار محمية للأسياد فقط
- **تسجيل شامل:** كل عملية فحص مُسجلة بالتفصيل في النظام الشامل
- **مراقبة مستمرة:** النظام يسجل كل محتوى يتم فحصه مع النتائج

### ✅ الإنجازات السابقة (الجلسة الثانية):
- **النظام الشامل أصبح الأساسي:** تم تحديث `handlers/messages.py` لجعل النظام الشامل يعمل كنظام أساسي
- **الأنظمة القديمة كاحتياط:** الآن تعمل `handle_new_profanity_system` كنظام احتياطي

### 🚀 النظام الشامل لكشف المحتوى (إنجاز عملاق!):

#### 🛡️ النظام المتقدم الجديد:
- **دمج كامل:** تم دمج نظام كشف السباب مع نظام كشف المحتوى الإباحي
- **فحص شامل:** جميع أنواع المحتوى (نصوص، صور، فيديوهات، ملصقات، ملفات)
- **ذكاء اصطناعي:** تحليل متقدم بـ Google AI (Gemini) لكشف المحتوى غير المناسب
- **عقوبات متدرجة:** من التحذير إلى الطرد النهائي حسب درجة الخطورة
- **تقارير المشرفين:** نظام تقارير فوري ومفصل للمشرفين

#### 🔧 الملفات الجديدة المطورة:
- `modules/comprehensive_content_filter.py` - النظام الشامل الرئيسي
- `modules/admin_reports_system.py` - نظام تقارير المشرفين المتقدم
- `handlers/comprehensive_content_handler.py` - المعالج الشامل المتكامل
- `modules/comprehensive_admin_commands.py` - أوامر إدارية شاملة للمشرفين

#### 🎯 الميزات الجديدة المتقدمة:

##### 1. فحص شامل للمحتوى:
- **النصوص:** كشف السباب + فحص السياق الجنسي + كلمات مفاتيح متقدمة
- **الصور:** تحليل بالذكاء الاصطناعي لكشف المحتوى الإباحي والعنيف
- **الفيديوهات:** استخراج إطارات وتحليلها + فحص اسم الملف
- **الملصقات:** فحص emoji + اسم الملف + تحليل محتوى الملصق كصورة
- **الملفات:** فحص نوع الملف + اسم الملف + تحليل محتوى الصور

##### 2. نظام العقوبات المتدرج:
- **مستوى 1:** تحذير عادي
- **مستوى 2:** كتم 5-30 دقيقة
- **مستوى 3:** كتم 1-6 ساعات  
- **مستوى 4:** كتم 24 ساعة إلى دائم
- **مستوى 5:** طرد نهائي من المجموعة

##### 3. نظام التقارير والإشعارات:
- **تنبيهات فورية:** إشعارات للمشرفين عند المخالفات الخطيرة
- **ملخص يومي:** تقرير شامل يومي للمجموعة
- **تقارير مفصلة:** تحليل مخاطر وإحصائيات متقدمة
- **تحكم بالاشتراك:** المشرفين يمكنهم تخصيص أنواع التقارير

#### ⚙️ الأوامر الإدارية الجديدة الشاملة:

##### 📊 أوامر الإحصائيات:
- `احصائيات الأمان` - إحصائيات شاملة للأمان
- `تقرير المجموعة` - تقرير مفصل للمجموعة
- `تقرير مستخدم [المعرف]` - تقرير مستخدم محدد
- `ملخص يومي` - ملخص اليوم الحالي

##### ⚙️ أوامر التحكم:
- `تفعيل النظام الشامل` - تفعيل الحماية الشاملة (مالكين وسادة فقط)
- `تعطيل النظام الشامل` - تعطيل النظام (مالكين وسادة فقط)
- `حالة النظام` - عرض حالة النظام الشامل

##### 📧 أوامر التقارير:
- `اشتراك تقارير` - الاشتراك في التقارير
- `إلغاء اشتراك تقارير` - إلغاء الاشتراك
- `مراجعة تقرير [الرقم]` - مراجعة تقرير محدد

##### 🛠️ أوامر الإدارة المتقدمة:
- `حذف سجل مستخدم [المعرف]` - حذف سجل المخالفات (مالكين وسادة فقط)
- `إعادة تعيين نقاط [المعرف]` - إعادة تعيين النقاط التراكمية
- `قائمة المحظورين` - عرض المحظورين نهائياً

##### 📈 أوامر التحليل:
- `تحليل المخاطر` - تحليل مخاطر المجموعة
- `إحصائيات أسبوعية` - تقرير آخر أسبوع  
- `إحصائيات شهرية` - تقرير آخر شهر
- `تصدير التقارير` - تصدير ملف شامل

#### 🔒 نظام الصلاحيات المحدث:
- **مالكو المجموعات + السادة:** وصول كامل لجميع الأوامر
- **المشرفين:** وصول للتقارير والإحصائيات فقط
- **الأعضاء:** لا يوجد وصول للأوامر الإدارية
- **حماية مطلقة للسادة:** لا يمكن معاقبتهم بأي شكل

#### 🎯 التكامل والتوافق:
- **متوافق تماماً:** مع النظام القديم كنظام احتياطي
- **لا توجد تعارضات:** مع الأنظمة الموجودة
- **أداء محسن:** معالجة أسرع وأكثر دقة
- **استهلاك ذكي:** لمفاتيح API مع تبديل تلقائي

### 🔧 الأوامر الإدارية السابقة (ما زالت تعمل):
- `تفعيل كشف المحتوى` - تفعيل نظام الصور الأساسي
- `إلغاء كشف المحتوى` - إلغاء تفعيل نظام الصور
- `حالة كشف المحتوى` - حالة النظام الأساسي

## 🔄 التحديثات السابقة (27 أغسطس 2025)

### ✅ الإنجازات الرئيسية:
- **إصلاح نظام الخيارات المرقمة:** تم حل المشكلة التي كانت تمنع البوت من الاستجابة للأرقام في القوائم الذكية
- **نظام API جديد:** تم تطوير نظام لقراءة جميع مفاتيح API من ملف `api.txt` بدلاً من متغيرات البيئة
- **حالات FSM محدثة:** إضافة حالات جديدة للتعامل مع الخيارات الذكية المرقمة
- **معالجات متخصصة:** إنشاء معالجات مخصصة للقوائم الذكية والتفاعل معها

### 🔧 التحديثات التقنية:

#### 1. نظام تحميل API الجديد
- **الملف:** `utils/api_loader.py`
- **الوظيفة:** قراءة مفاتيح API من ملف `api.txt` بصيغة محددة
- **الدعم:** OpenAI, Anthropic, Telegram Bot Token, YouTube API

#### 2. حالات FSM محدثة  
- **الملف:** `utils/states.py`
- **الحالات الجديدة:** SmartCommandStates مع 6 حالات مختلفة للتفاعل الذكي
- **الميزات:** دعم الكويز، القصص التفاعلية، معارك الذكاء، التحديات الاقتصادية

#### 3. معالج القوائم الذكية
- **الملف:** `modules/smart_menu_handler.py`  
- **الوظائف:** معالجة مخصصة لكل نوع من أنواع التفاعل الذكي
- **التكامل:** يستخدم الذكاء الاصطناعي لإنشاء محتوى مخصص

#### 4. معالج الرسائل المحدث
- **الملف:** `handlers/messages.py`
- **إضافات:** معالجات جديدة للحالات الذكية مع دوال مخصصة لكل نوع تفاعل
- **الوظائف:** handle_quiz_answer, handle_story_choice, handle_battle_answer, handle_challenge_answer

#### 5. أوامر ذكية جديدة
- **الملف:** `handlers/smart_commands.py`
- **الأوامر:** قائمة شاملة من الأوامر الذكية المباشرة والتفاعلية
- **الميزات:** كشف النصوص العربية المتنوعة للأوامر

### 📁 الملفات المهمة المُحدّثة:
- `utils/api_loader.py` - نظام تحميل API جديد
- `utils/states.py` - حالات FSM للخيارات الذكية
- `modules/smart_menu_handler.py` - معالج القوائم الذكية
- `config/settings.py` - تحديث لاستخدام النظام الجديد
- `modules/real_ai.py` - تحديث للتكامل مع النظام الجديد
- `handlers/messages.py` - معالجات الحالات الذكية
- `handlers/smart_commands.py` - أوامر ذكية جديدة
- `main.py` - إدراج المعالجات الجديدة
- `utils/decorators.py` - إصلاح مشاكل الاستيراد الدائرية

### 🎯 الميزات الجديدة المتاحة:

#### 1. القائمة الذكية الرئيسية
- **الأمر:** "قائمة ذكية" أو "القائمة الذكية"
- **الخيارات:** 8 خيارات ذكية مع أرقام للاختيار
- **التفاعل:** يكتب المستخدم رقم الخيار ويحصل على الخدمة

#### 2. الأوامر الذكية المباشرة:
- **التحليل الاقتصادي:** "تحليل اقتصادي" أو "حلل وضعي"
- **استراتيجية الاستثمار:** "استراتيجية ذكية" أو "اقترح استراتيجية"  
- **الألعاب الذكية:** "العاب ذكية" أو "اقترح لعبة"
- **الكويز الذكي:** "كويز ذكي" أو "اختبار ذكي"
- **التحدي الاقتصادي:** "تحدي اقتصادي" أو "تحدي ذكي"
- **القصة التفاعلية:** "قصة ذكية" أو "احكي قصة"
- **معركة الذكاء:** "معركة ذكية" أو "تحدي يوكي"
- **حالة الأنظمة:** "حالة الذكاء الاصطناعي"

### 📋 تنسيق ملف api.txt:
```
ai 1:your-openai-api-key-here
ai 2:your-anthropic-api-key-here  
tokenBot:your-telegram-bot-token-here
apiyutube:your-youtube-api-key-here
```

## 🎮 كيفية استخدام الميزات الجديدة:

### للمستخدمين:
1. **ابدأ بـ:** "قائمة ذكية" لرؤية جميع الخيارات
2. **اكتب رقم الخيار** (1-8) للاختيار
3. **تابع التعليمات** للحصول على تجربة تفاعلية مخصصة
4. **استخدم الأوامر المباشرة** للوصول السريع للميزات

### للمطورين:
1. **ملف API:** قم بتحديث ملف `api.txt` بمفاتيح API الصحيحة
2. **الاختبار:** جرب "قائمة ذكية" في مجموعة تيليجرام
3. **المتابعة:** راقب السجلات للتأكد من عمل جميع المعالجات
4. **التخصيص:** يمكن إضافة المزيد من الخيارات في `smart_menu_handler.py`

## 🔧 الحالة الحالية:
- ✅ البوت يعمل بنجاح
- ✅ نظام الخيارات المرقمة يعمل
- ✅ قراءة API من الملف تعمل  
- ✅ جميع المعالجات مُسجّلة
- ✅ لا توجد أخطاء في الكود

## 📝 ملاحظات المطور:
- تم إصلاح مشكلة الاستيراد الدائري في decorators.py
- تم إضافة معالجات XP و مكافآت للتفاعلات
- النظام يدعم اللغة العربية بشكل كامل
- جميع الرسائل والردود مُحسّنة للمستخدم العربي